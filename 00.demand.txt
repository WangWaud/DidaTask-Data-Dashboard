# 滴答清单数据看板 - 需求文档
## 项目概述
基于滴答清单备份 CSV 文件，构建一个本地运行的个人任务时间统计看板。
通过导入 dida365.com 导出的备份 CSV，实现历史任务的表格展示与时间可视化分析。

> ⚠️ 数据来源已由 Open API 改为 CSV 导入（原因：v1 API 不返回已完成任务）

---

## 技术栈
- 后端：Node.js + Express（本地静态文件服务）
- 前端：HTML + CSS + JavaScript（原生，无框架）
- 图表库：ECharts 5.4.3（CDN）
- 运行方式：本地启动，访问 http://localhost:3000

---

## 清单结构（滴答清单侧配置）

### 文件夹 / 子清单层级
```
📚 学术研究（文件夹）
   ├── 📄 文献
   ├── ⚗️ 实验
   └── 🏅 学术目标

💬 突发事件（独立清单）

👷 工作事务（文件夹）
   ├── 💰 工作
   └── 👨‍🏫 助学

🐟 休闲娱乐（独立清单）

🆙 自我提升（文件夹）
   ├── 😊 提升
   ├── 📖 阅读
   └── 🎾 运动健康
```

### 标签结构
```
突发（父标签）
   ├── 生活
   ├── 工作
   └── 学术

实验室杂事
开发
聚餐
摸鱼
电影和剧集
阅读
```

### 任务填写规范
- **必填**：开始时间 + 结束时间（时长统计的基础）
- **所属清单**：选对子清单，而非文件夹
- **标签**：突发事件打对应子标签；其他任务按需打内容标签
- 时间统计仅针对**有 startDate 和 dueDate** 的非全天任务

---

## API 数据结构（CSV 字段映射）

### CSV 导出路径
dida365.com → 左上角头像 → 设置 → 账户 → 数据备份 → 生成备份 → 下载 .csv

### CSV 关键字段
| CSV 列名 | 对应含义 | 备注 |
|---------|---------|------|
| Title | 任务名称 | |
| List Name | 所属清单名称 | 子清单名，如"文献" |
| Folder Name | 所属文件夹名称 | 如"学术研究" |
| Tags | 标签 | 逗号分隔 |
| Start Date | 开始时间 | ISO 8601 |
| Due Date | 结束/截止时间 | ISO 8601 |
| Completed Time | 完成时间 | 有值则为已完成任务 |
| Is All Day | 是否全天 | true/false |
| Status | 状态 | 0=未完成，2=已完成 |
| Priority | 优先级 | 0=无，1=低，3=中，5=高 |
| taskId | 任务唯一 ID | |

> CSV 前 6 行为元数据，第 7 行为真正的表头

### 时长计算规则
- 非全天任务：时长 = dueDate - startDate（单位：小时）
- 全天任务：标注为"全天"，不计入时长统计



## 功能需求

### 模块一：任务表格视图
**目标**：将任务、清单、标签整理成结构化表格，支持时间维度筛选。

#### 表格列
| 列名     | 字段来源              | 说明                  |
|--------|-------------------|--------------------|
| 任务名称   | title             |                    |
| 所属清单   | projectId → name  | 通过 ID 映射清单名称        |
| 标签     | tags              | 多个标签用逗号分隔           |
| 开始时间   | startDate         | 格式化显示               |
| 结束时间   | dueDate           | 格式化显示               |
| 时长     | dueDate-startDate | 非全天任务显示小时数，全天显示"全天" |
| 优先级    | priority          | 无/低/中/高             |
| 完成状态   | status            | 未完成/已完成             |

#### 时间筛选维度
- 日（选择某一天，展示当天有 startDate 或 dueDate 的任务）
- 周（选择某一周）
- 月（选择某月）
- 季度（选择某季度）
- 年（选择某年）

#### 筛选逻辑
- 以任务的 **dueDate（截止日期）** 为主筛选字段
- 若 dueDate 为空，则以 startDate 为备用筛选字段

---

### 模块二：时间分布可视化
**目标**：展示一段时间内，各清单（项目）占用的时间分布。

#### 图表类型
1. **柱状图**：各清单在选定时间段内每天/每周的时间投入对比
2. **饼图/环形图**：选定时间段内各清单时间占比
3. **折线图**：某清单时间投入的趋势变化（可选）

#### 时间聚合维度
- 与表格视图保持一致：日 / 周 / 月 / 季度 / 年

#### 数据来源
- 仅统计**非全天任务**（isAllDay = false）且有 startDate 和 dueDate 的任务
- 时长 = dueDate - startDate，单位：小时

---

---

## 后端路由（仅保留静态服务）

| 路由 | 方法 | 说明 |
|------|------|------|
| / | GET | 返回 public/index.html |
| /style.css | GET | 静态样式 |
| /app.js | GET | 静态前端逻辑 |

> OAuth 相关路由已废弃，服务器仅作静态文件托管

---

## 页面布局设计

```
┌─────────────────────────────────────────────────────┐
│  顶部导航栏：标题 + CSV 徽标 + 导入CSV + 清除CSV        │
├─────────────────────────────────────────────────────┤
│  时间维度：[ 日 | 周 | 月 | 季度 | 年 ] + 日期导航      │
│  清单筛选：[ 全部 | 文献 | 实验 | ... ]（动态生成）      │
├──────────────────────┬──────────────────────────────┤
│                      │  右上：饼图（时间占比）          │
│  左：任务表格          ├──────────────────────────────┤
│                      │  右下：柱状图（时间趋势）         │
└──────────────────────┴──────────────────────────────┘
```

---

## 注意事项
1. CSV 数据持久化在浏览器 localStorage，刷新页面不丢失
2. 所有时间统一转换为用户本地时区处理
3. 时间统计仅统计非全天、有 startDate 和 dueDate 的任务
4. 清单筛选按钮根据当前时间范围内实际出现的清单动态生成

